<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Recibo – Tijuana Tours</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
  
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

  
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
  body { background:#eef3f9; }

  :root {
    --azul-header: #0a2a43;
    --azul-titulo: #0d5c7d;
    --azul-borde: #0a2a43;
    --azul-barra: #0c3a5d;
  }

  .ticket {
    width: 480px;
    background: white;
    margin: auto;
    padding: 0;
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    border-radius: 10px;
    overflow: hidden;
  }

  .header {
    background: var(--azul-header);
    color: white;
    padding: 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  .header .logo {
    width: 90px;
    height: 90px;
    background:#cfe2ff22;
    border:1px dashed #ffffff66;
    border-radius:10px;
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
  }

  .title {
    font-size:32px;
    text-align:right;
    line-height:1.1;
    color:#b8e7ff;
    font-weight:700;
  }

  .section {
    border:1px solid var(--azul-borde);
    padding:15px;
    margin:0;
  }

  .label {
    font-weight:600;
    color: var(--azul-borde);
  }

  .barra-qr {
    background: var(--azul-barra);
    text-align:center;
    padding: 12px 0;
  }

  #qr {
    margin:auto;
    width: 140px;
  }

  .footer {
    background: var(--azul-header);
    color:white;
    text-align:center;
    padding:15px;
    font-size:14px;
  }

  .footer small { display:block; }
</style>
</head>

<body class="p-4">

<div class="container">
  <h2 class="text-center fw-bold text-primary mb-4">
    <i class="bi bi-file-earmark-text"></i> Generador de Recibos – Tijuana Tours
  </h2>

  <!-- FORM -->
  <div class="card p-4 shadow-lg border-0" style="border-radius: 18px;">
    <form id="formRecibo">

      <div class="row mb-3">
        <div class="col-md-6">
          <label class="fw-bold">Tipo de Recibo</label>
          <select id="tipo" class="form-select" onchange="validarMonto()">
            <option value="#">Selecciona Una Opcion</option>
            <option value="Liquidación">Liquidación</option>
            <option value="Abono">Abono</option>
          </select>
        </div>

        <div class="col-md-3">
          <label class="fw-bold">Recibo #</label>
          <input id="numero" class="form-control" readonly />
        </div>

        <div class="col-md-3">
          <label class="fw-bold">Fecha</label>
          <input id="fecha" class="form-control" readonly />
        </div>
      </div>

      <label class="fw-bold">Cliente</label>
      <input id="cliente" class="form-control mb-3" placeholder="Nombre del cliente" />

      <label class="fw-bold">Tour / Servicio</label>
      <input id="servicio" class="form-control mb-3" placeholder="Ej. Renta de autobús" />

      <!-- Campo monto dinámico -->
      <label class="fw-bold">Monto</label>
      <input id="monto" class="form-control mb-3" placeholder="$0.00" />

      <label class="fw-bold">Descripción del Servicio</label>
      <textarea id="descripcion" class="form-control mb-3" rows="4"></textarea>

      <!-- BOTÓN IA -->
      <button type="button" class="btn btn-info mb-3 fw-bold" onclick="mejorarDescripcion()">
        <i class="bi bi-stars"></i> Mejorar descripción
      </button>
      <div id="progresoIA" class="text-primary fw-bold mb-3" style="display:none;">Mejorando descripción...</div>

      <!-- Dropdown oculto para “generado por” -->
      <select id="generado" style="display:none">
        <option value="Paty García">Paty García</option>
        <option value="Fátima Ruiz" selected>Fátima Ruiz</option>
      </select>

      <button type="button" onclick="generarPreview()" class="btn btn-success w-100 fw-bold">
        <i class="bi bi-eye-fill"></i> Vista Previa
      </button>

    </form>
  </div>
</div>

<!-- MODAL PREVIEW -->
<div class="modal fade" id="modalPreview">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content p-3">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Vista previa del recibo</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div id="preview" class="ticket"></div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Modificar</button>
        <button class="btn btn-primary" onclick="guardarPNG()"><i class="bi bi-download"></i> Descargar</button>
        <button class="btn btn-success" onclick="enviarWS()"><i class="bi bi-whatsapp"></i> WhatsApp</button>
      </div>
    </div>
  </div>
</div>


<script>
document.getElementById("numero").value = generarNum();
document.getElementById("fecha").value = new Date().toLocaleDateString();

const ciudadAuto = "Tijuana, Baja California Norte";
const telAuto = "6647277107";

function generarNum() {
  let f = new Date();
  let m = (f.getMonth()+1).toString().padStart(2,"0");
  let d = f.getDate().toString().padStart(2,"0");
  let r = Math.floor(Math.random()*900 + 100);
  return `${m}${d}-${r}`;
}

// Monto dinámico
function validarMonto() {
  if (tipo.value === "Liquidación") {
    monto.value = "Liquidado";
    monto.disabled = true;
  } else {
    monto.value = "";
    monto.disabled = false;
  }
}

// IA LOCAL SIN API
function mejorarDescripcion() {
  let t = descripcion.value.trim();
  if (!t) { alert("Escribe una descripción primero."); return; }

  progresoIA.style.display = "block";

  setTimeout(() => {
    t = t
      .replace(/\s+/g, " ")
      .replace(/ ,/g, ",")
      .replace(/^./, c => c.toUpperCase())
      .replace(/\.$/, "")
      .trim();

    descripcion.value =
      `Servicio solicitado por el cliente, correspondiente a: ${t}. ` +
      `Se confirma que la unidad será asignada según disponibilidad y condiciones establecidas.`;

    progresoIA.style.display = "none";
  }, 600);
}


// PREVIEW
function generarPreview() {
  const prev = document.getElementById("preview");
  prev.innerHTML = `
    <div class="header">
      <div class="logo">
        <img src="https://i.ibb.co/B5dhX7Z1/499871133-1116059227215315-5067798107355192006-n.jpg"
             style="width:100%; height:100%; object-fit:cover; border-radius:10px;" />
      </div>
      <div class="title">
        Recibo de<br>${tipo.value}
      </div>
    </div>

    <div class="section">
      <strong class="label">RECIBO#:</strong> ${numero.value}
      &nbsp;&nbsp;&nbsp;
      <strong class="label">FECHA:</strong> ${fecha.value}
    </div>

    <div class="section">
      <strong class="label">CLIENTE:</strong> ${cliente.value}
      &nbsp;&nbsp;&nbsp;
      <strong class="label">SERVICIO:</strong> ${servicio.value}
    </div>

    <div class="section">
      <strong class="label">CIUDAD:</strong> ${ciudadAuto}
      &nbsp;&nbsp;&nbsp;
      <strong class="label">TEL:</strong> ${telAuto}
    </div>

    <div class="section">
      <strong class="label">MONTO:</strong> ${monto.value}
    </div>

    <div class="section">
      <strong class="label">DESCRIPCIÓN:</strong><br>${descripcion.value}
    </div>

    <div class="barra-qr"><div id="qr"></div></div>

    <div class="footer">
      <small>Recibo generado el día ${fecha.value} por ${generado.value}</small>
      <small>FRACC Natura Privada Abedul</small>
      <small>664-727-71-07</small>
      <small>www.fb.com/tijuanatoursmx</small>
    </div>
  `;

  // QR
  document.getElementById("qr").innerHTML = "";
  new QRCode(document.getElementById("qr"), {
    text: "https://tijuanatours.github.io/site/scan.html",
    width: 120,
    height: 120
  });

  new bootstrap.Modal(document.getElementById("modalPreview")).show();
}


// PNG
function guardarPNG() {
  html2canvas(document.querySelector("#preview")).then(canvas => {
    const link = document.createElement("a");
    link.download = `recibo_${numero.value}.png`;
    link.href = canvas.toDataURL();
    link.click();
  });
}

// WhatsApp
function enviarWS() {
  const mensaje = encodeURIComponent("Hola, te envío tu recibo. La imagen se descargó automáticamente, adjúntala aquí.");
  window.open(`https://wa.me/526644402478?text=${mensaje}`, "_blank");
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
